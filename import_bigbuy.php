<?php
ini_set('max_execution_time', 0);
set_time_limit(0);
ini_set('memory_limit', '1024M'); // verhoog tijdelijk
register_shutdown_function(function(){
    $err = error_get_last();
    if ($err) {
        $msg = sprintf("[%s] SHUTDOWN: type=%s file=%s line=%s msg=%s\n",
            date('Y-m-d H:i:s'), $err['type'], $err['file'], $err['line'], $err['message']
        );
        file_put_contents('/home/stylisso/logs/bigbuy_shutdown.log', $msg, FILE_APPEND);
    } else {
        file_put_contents('/home/stylisso/logs/bigbuy_shutdown.log', "[".date('Y-m-d H:i:s')."] SHUTDOWN: no error (possible SIGKILL)\n", FILE_APPEND);
    }
});

error_reporting(E_ALL);
ini_set('display_errors', 1);
ini_set('log_errors', 1);
ini_set('error_log', '/home/stylisso/logs/php_error.log');

$lockFile = '/tmp/import_bigbuy.lock';

// Check of er al een lock is
if (file_exists($lockFile)) {
    $pid = (int) trim(file_get_contents($lockFile));
    if ($pid && posix_kill($pid, 0)) {
        echo "â­ Script draait al (PID $pid), stoppen.\n";
        exit;
    } else {
        // stale lock
        unlink($lockFile);
    }
}

// Lock aanmaken
file_put_contents($lockFile, getmypid());

// âœ… Plaats hier de shutdown-cleanup
register_shutdown_function(function() use ($lockFile) {
    if (file_exists($lockFile)) {
        unlink($lockFile);
    }
});

require __DIR__ . '/db_connect.php';
require __DIR__ . '/bigbuy.php';

$api = new BigBuyAPI();

function logMessage($msg) {
    file_put_contents("/home/stylisso/logs/bigbuy_import.log", date("Y-m-d H:i:s") . " - $msg\n", FILE_APPEND);
}

// ----------------------------------------
// Functie: prijs verhogen met 15 â‚¬ of 30 % en afronden op .99
// ----------------------------------------
function prijsMetAfronding(float $prijs): float {
    if ($prijs < 50) {
        $prijs += 15;
    } else {
        $prijs = $prijs * 1.30;
    }
    return ceil($prijs) - 0.01;
}

// --- Producten die je wilt importeren ---
$selectedProducts = [
    1138002,
    306246,
    441567,
    452825,
    1132319,
    1132054,
    531156,
    344493,
    1071278,
    721878,
    1132065,
    306387,
    137931,
    1178089,
    762393,
    491878,
    305825,
    1077010,
    490718,
    1225697,
    1137530,
    1217043,
    1061307,
    311992,
    438008,
    490702,
    1045386,
    1225978,
    314084,
    564026,
    897326,
    897297,
    897286,
    1076918,
    796505,
    491884,
    786802,
    453855,
    491885,
    1077058,
    1183836,
    442781,
    490722,
    1076968,
    1076902,
    1076897,
    1077050,
    308073,
    353977,
    496216,
    1137526,
    1180738,
    441806,
    308557,
    438607,
    440549,
    440599,
    433534,
    1131343,
    1087906,
    451262,
    379926,
    649520,
    451271,
    1071091,
    893982,
    929593,
    649556,
    649560,
    929563,
    499198,
    652417,
    652409,
    1127578,
    1071290,
    1071271,
    1184477,
    897877,
    495971,
    648546,
    1131341,
    311190,
    1183832,
    442804,
    442518,
    511934,
    492549,
    1132313,
    492531,
    601149,
    1183839,
    489237,
    386536,
    649482,
    1132315,
    650835,
    564210,
    1137519,
    1071519,
    1131346,
    1181277,
    498602,
    591155,
    490717,
    932337,
    319468,
    443839,
    788666,
    1076957,
    1076974,
    451211,
    1077049,
    306320,
    785250,
    785162,
    530765,
    1127359,
    441572,
    119453,
    933778,
    652520,
    307141,
    785209,
    934975,
    934987,
    457461,
    496217,
    319470,
    437172,
    322275,
    600716,
    680233,
    567639,
    1132795,
    1184469,
    490710,
    600719,
    1217600,
    1072290,
    1072326,
    1072289,
    437168,
    490716,
    1137536,
    44182,
    308125,
    1088539,
    653626,
    788429,
    307037,
    308556,
    441846,
    1088127,
    1093589,
    1088611,
    1132814,
    1073814,
    510322,
    1073786,
    831388,
    1077015,
    831416,
    776197,
    1240562,
    1175274,
    317057,
    1132298,
    1132312,
    1132079,
    438934,
    1217601,
    502301,
    897302,
    1129005,
    451267,
    1132051,
    1132898,
    1088559,
    1087908,
    1168340,
    1131349,
    1132807,
    1132089,
    531173,
    441820,
    786569,
    651306,
    786567,
    936328,
    569302,
    817055,
    352876,
    1087777,
    451747,
    600681,
    796503,
    796507,
    1089249,
    1130413,
    1087784,
    1087782,
    648959,
    452814,
    1061555,
    1061545,
    1061534,
    437993,
    443849,
    438950,
    1130590,
    441884,
    786818,
    786854,
    440299,
    936330,
    1130599,
    1127283,
    1130544,
    1127374,
    936307,
    929693,
    784395,
    649547,
    649567,
    1190941,
    437243,
    929569,
    936353,
    1168473,
    1170354,
    1170083,
    649370,
    929645,
    351567,
    929534,
    936340,
    929690,
    929662,
    1263255,
    1263028,
    1263029,
    1263030,
    1263031,
    1263034,
    1263035,
    1263036,
    1263037,
    1263038,
    1263039,
    1263040,
    1263042,
    1263043,
    1263044,
    1263045,
    1263046,
    1263047,
    1263048,
    1263049,
    1263138,
    1263145,
    1263158,
    1263159,
    1263160,
    1263162,
    1263166,
    1263167,
    1263168,
    1263170,
    1263177,
    1263188,
    1263195,
    1263197,
    1263226,
    1263244,
    1263246,
    1263248,
    1260564,
    1260571,
    1260565,
    1260561,
    1260560,
    1260575,
    1260563,
    1260581,
    1260591,
    1260569,
    1260588,
    1260590,
    1260574,
    1260596,
    1260592,
    1260567,
    1260570,
    1260573,
    1260583,
    1260576,
    1260572,
    1260580,
    1260582,
    1260589,
    1260594,
    1260597,
    1260579,
    1260598,
    1260599,
    1260600,
    1260585,
    1260647,
    1260648,
    1261767,
    1261783,
    1261785,
    1261786,
    1262196,
    1262199,
    1262202,
    1262203,
    1262204,
    1262204,
    1262205,
    1262206,
    1262216,
    1262211,
    1262208,
    1262207,
    1262217,
    1262224,
    1262225,
    1262226,
    1262227,
    1262228,
    1262230,
    1262229,
    1262231,
    1262287,
    1262288,
    1260255,
    1260199,
    1260247,
    1260286,
    1260288,
    1260287,
    1260203,
    1260209,
    1260206,
    1260211,
    1260214,
    1260217,
    1260222,
    1260224,
    1260229,
    1260133,
    1260232,
    1260290,
    1260266,
    1260240,
    1260833,
    1260836,
    1260834,
    1260142,
    1260290,
    1260266,
    1260240,
    1260242,
    1260246,
    1260249,
    1260180,
    1260180,
    1260252,
    1260289,
    1260371,
    1260372,
    1260292,
    1260254,
    1260228,
    1260291,
    1260134,
    1260197,
    1260258,
    1260235,
    1260186,
    1260173,
    1260293,
    1260260,
    1260154,
    1260554,
    1260555,
    1260557,
    1260559,
    1260558,
    1260142,
    1259374,
    1259384,
    1259498,
    1259497,
    1259491,
    1259494,
    1259487,
    1259447,
    1259493,
    1259492,
    1259488,
    1259481,
    1259470,
    1259476,
    1259360,
    1259278,
    1259324,
    1259312,
    1259429,
    1259419,
    1259400,
    1259393,
    1259362,
    1259353,
    1259343,
    1259297,
    1259467,
    1259463,
    1259461,
    1259320,
    1259460,
    1259456,
    1259445,
    1259449,
    1259412,
    1259420,
    1259428,
    1259437,
    1259490,
    1259391,
    1259332,
    1259307,
    1259363,
    1259344,
    1259434,
    1259399,
    1259407,
    1259418,
    1259443,
    1259451,
    1259440,
    1259455,
    1259466,
    1259442,
    1259462,
    1259457,
    1259473,
    1259355,
    1259345,
    1259477,
    1259367,
    1259485,
    1259376,
    1259383,
    1259389,
    1259396,
    1259489,
    1259402,
    1259408,
    1259415,
    1259421,
    1259221,
    1259444,
    1259375,
    1259469,
    1259425,
    1260159,
    1260163,
    1260245,
    1260278,
    1260250,
    1260165,
    1260202,
    1260268,
    1260207,
    1260210,
    1260191,
    1260212,
    1260226,
    1260243,
    1260179,
    1260264,
    1260267,
    1260269,
    1260182,
    1260241,
    957090,
    387398,
    167997,
    319358,
    437221,
    454445,
    457471,
    457472,
    582803,
    652965,
    652985,
    652964,
    703152,
    862109,
    862112,
    862108,
    862110,
    862107,
    957088,
    957089,
    506463,
    506464,
    777489,
    1198957,
    1199213,
    1197822,
    872490,
    1076925,
    1131702,
    1181876,
    1181874,
    1191191,
    1191196,
    1191218,
    1191241,
    1191233,
    1066566,
    1066554,
    1066329,
    897815,
    1089946,
    1089951,
    1090023,
    1090025,
    1090027,
    1089892,
    1090037,
    1089954,
    1090026,
    1090030,
    1122307,
    1127600,
    1127606,
    1138577,
    1138855,
    1138863,
    1183786,
    1183758,
    1183773,
    1183777,
    1185083,
    1185089,
    1191626,
    1191628,
    1191629,
    1191656,
    1191639,
    1191643,
    1191641,
    1191645,
    655453,
    655601,
    655395,
    655313,
    635880,
    299423,
    362259,
    266672,
    266671,
    375857,
    362357,
    375759,
    375858,
    506348,
    506454,
    658292,
    658295,
    986177,
    1001004,
    1001005,
    1001007,
    1078399,
    1091813,
    1001013,
    1001481,
    1078405,
    1078346,
    1078325,
    1078379,
    1095173,
    1095435,
    1095854,
    1095874,
    1095882,
    1095881,
    1095888,
    1095889,
    1095883,
    1142754,
    1142758,
    1142757,
    1142765,
    1178141,
    1178142,
    1178140,
    1178143,
    1190593,
    1190601,
    1190606,
    1190608,
    1190614,
    1199223,
    1199224,
    1206299,
    1208094,
    1208102,
    1208095,
    1208098,
    1208099,
    1208107,
    1208108,
    1208103,
    1208109,
    1208104,
    1208105,
    1208112,
    1229896,
    1229900,
    1263846,
    1262545,
    1262546,
    1262547,
    1262548,
    1262549,
    1262550,
    1262551,
    1262552,
    1262553,
    1262554,
    1262555,
    1262556,
    1262557,
    1262558,
    1262559,
    1262560,
    1262561,
    1262562,
    1262563,
    1262564,
    1263627,
    1264118,
    1264064,
    1264036,
    1264111,
    1264121,
    1264138,
    1264133,
    1264051,
    1264059,
    1264116,
    1264072,
    1264147,
    1264158,
    1264037,
    1170329,
    1170418,
    1170350,
    1170415,
    1170551,
    1122319,
    1094752,
    1082508,
    1045238,
    1041256,
    955840,
    878638,
    878635,
    872772,
    872773,
    865292,
    861239,
    861241,
    832116,
    647779,
    647768,
    647781,
    647763,
    612739,
    583018,
    293933,
    1040629,
    1040627,
    1040613,
    677947,
    552623,
    492299,
    335135,
    330319,
    1266221,
    1266196,
    1266181,
    1266251,
    1266225,
    1266208,
    1266272,
    1217385,
    1190758,
    1190830,
    1190827,
    1190867,
    1190872,
    1190757,
    1190861,
    1190843,
    1190848,
    1190783,
    1190737,
    1190784,
    1190708,
    1180266,
    1181377,
    1180281,
    1180141,
    1180885,
    1181371,
    1180143,
    1181368,
    1180280,
    1181364,
    1181370,
    1180279,
    1180174,
    1181342,
    1180860,
    1181319,
    1181329,
    1180846,
    1180365,
    1181335,
    1181312,
    1180360,
    1181321,
    1181307,
    1180099,
    1180427,
    1181317,
    1180102,
    1180064,
    1181256,
    1180932,
    1180936,
    1180278,
    1180921,
    1180269,
    1180829,
    1170593,
    1170592,
    1170127,
    1170139,
    1170138,
    1170141,
    1170147,
    1170135,
    1170585,
    1170560,
    1170589,
    1169251,
    1122812,
    1108871,
    1093842,
    1093840,
    1093846,
    1082618,
    1082415,
    1082411,
    1082414,
    1082413,
    1082407,
    1082403,
    1072361,
    1072370,
    1069245,
    1051636,
    1045250,
    1045248,
    1041245,
    1041242,
    1041243,
    1041231,
    1003295,
    910183,
    438550,
    438549,
    1051628,
    1040641,
    1040619,
    1040632,
    1040615,
    1040612,
    1040621,
    1040604,
    1040600,
    910196,
    808142,
    807596,
    807564,
    775798,
    654571,
    492192,
    171498,
    1170341,
    1180883,
    1180114,
    1180893,
    1180809,
    1181247,
    1180728,
    1180270,
    1180155,
    1181276,
    1181305,
    1181310,
    1181340,
    1181318,
    1190690,
    1190703,
    1190709,
    1190707,
    1190720,
    1190761,
    1190760,
    1190726,
    1190773,
    1190852,
    1190791,
    1190842,
    1250090,
    1250003,
    1260218,
    1265908,
    1265916,
    1265909,
    1265910,
    1265914,
    1265911,
    1265912,
    1265913,
    1265915,
    1265917,
    1265918,
    1265919,
    1265921,
    1265930,
    1265931,
    1265935,
    1265936,
    1265933,
    1265934,
    1265937,
    1265938,
    1265939,
    1265940,
    1265945,
    1265946,
    401457,
    771146,
    784885,
    784887,
    980854,
    980855,
    1082136,
    1122314,
    1190845,
    1251546,
    1089860,
    680320,
    680319,
    680308,
    777167,
    777169,
    777170,
    777859,
    1066608,
    297484,
    301033,
    302751,
    325591,
    330416,
    330418,
    492160,
    492167,
    807573,
    807578,
    807586,
    178623,
    1070758,
    1089675,
    1093478,
    1093479,
    1093487,
    1093491,
    1093485,
    1093483,
    1108152,
    1118106,
    1122814,
    1217594,
    1217595,
    1217597,
    1217604,
    1253023,
];

// --- Categorie mapping ---
$productCategoryMap = [
    1138002 => 2,
    306246 => 1,
    441567 => 1,
    452825 => 2,
    1132319 => 2,
    1132054 => 1,
    531156 => 1,
    344493 => 1,
    1071278 => 1,
    721878 => 3,
    1132065 => 1,
    306387 => 1,
    137931 => 3,
    1178089 => 2,
    762393 => 1,
    491878 => 1,
    305825 => 1,
    1077010 => 1,
    490718 => 1,
    1225697 => 3,
    1137530 => 1,
    1217043 => 1,
    1061307 => 1,
    311992 => 1,
    438008 => 1,
    490702 => 1,
    1045386 => 1,
    1225978 => 1,
    314084 => 2,
    564026  => 1,
    897326  => 1,
    897297  => 1,
    897286  => 1,
    1076918  => 2,
    796505  => 1,
    491884  => 1,
    786802  => 1,
    453855  => 1,
    491885  => 1,
    1077058  => 1,
    1183836  => 2,
    442781  => 1,
    490722  => 2,
    1076968  => 1,
    1076902  => 1,
    1076897  => 1,
    1077050  => 1,
    308073  => 2,
    353977  => 1,
    496216  => 1,
    1137526  => 1,
    1180738  => 1,
    441806  => 2,
    308557  => 1,
    438607  => 1,
    440549  => 1,
    440599  => 1,
    433534  => 3,
    1131343  => 1,
    1087906  => 1,
    451262  => 1,
    379926  => 1,
    649520  => 1,
    451271  => 1,
    1071091  => 1,
    893982  => 1,
    929593  => 1,
    649556  => 1,
    649560  => 1,
    929563  => 1,
    499198  => 1,
    652417  => 1,
    652409  => 1,
    1127578  => 1,
    1071290  => 1,
    1071271  => 1,
    1184477  => 1,
    897877  => 1,
    495971  => 1,
    648546  => 1,
    1131341  => 2,
    311190  => 2,
    1183832  => 2,
    442804  => 2,
    442518  => 2,
    511934  => 2,
    492549  => 2,
    1132313  => 2,
    492531  => 2,
    601149  => 2,
    1183839  => 2,
    489237  => 2,
    386536  => 2,
    649482  => 1,
    1132315  => 2,
    650835  => 1,
    564210  => 2,
    1137519  => 1,
    1071519  => 2,
    1131346  => 2,
    1181277  => 2,
    498602  => 2,
    591155  => 2,
    490717  => 2,
    932337  => 2,
    319468  => 2,
    443839  => 2,
    788666  => 2,
    1076957 => 1,
    1076974 => 1,
    451211 => 2,
    1077049 => 1,
    306320 => 1,
    785250 => 1,
    785162 => 1,
    530765 => 1,
    1127359 => 2,
    441572 => 2,
    119453 => 3,
    933778 => 1,
    652520 => 1,
    307141 => 1,
    785209 => 1,
    934975 => 1,
    934987 => 2,
    457461 => 1,
    496217 => 2,
    319470 => 1,
    437172 => 2,
    322275 => 1,
    600716 => 1,
    680233 => 1,
    567639 => 1,
    1132795 => 1,
    1184469 => 1,
    490710 => 1,
    600719 => 1,
    1217600 => 1,
    1072290 => 1,
    1072326 => 1,
    1072289 => 1,
    437168 => 1,
    490716 => 1,
    1137536 => 1,
    44182 => 1,
    308125 => 1,
    1088539 => 1,
    653626 => 1,
    788429 => 1,
    307037 => 1,
    308556 => 1,
    441846 => 1,
    1088127 => 1,
    1093589 => 1,
    1088611 => 2,
    1132814 => 1,
    1073814 => 1,
    510322 => 1,
    1073786 => 1,
    831388 => 3,
    1077015 => 2,
    831416 => 3,
    776197 => 3,
    1240562 => 3,
    1175274 => 3,
    317057 => 3,
    1132298 => 2,
    1132312 => 2,
    1132079 => 1,
    438934 => 2,
    1217601 => 2,
    502301 => 2,
    897302 => 2,
    1129005 => 2,
    451267 => 1,
    1132051 => 1,
    1132898 => 2,
    1088559 => 2,
    1087908 => 1,
    1168340 => 1,
    1131349 => 1,
    1132807 => 1,
    1132089 => 1,
    531173 => 1,
    441820 => 2,
    786569 => 2,
    651306 => 2,
    786567 => 2,
    936328 => 1,
    569302 => 1,
    817055 => 1,
    352876 => 1,
    1087777 => 1,
    451747 => 1,
    600681 => 1,
    796503 => 1,
    796507 => 1,
    1089249 => 1,
    1130413 => 1,
    1087784 => 1,
    1087782 => 1,
    648959 => 1,
    452814 => 1,
    1061555 => 1,
    1061545 => 1,
    1061534 => 1,
    437993 => 1,
    443849 => 1,
    438950 => 1,
    1130590 => 1,
    441884 => 1,
    786818 => 1,
    786854 => 1,
    440299 => 1,
    936330 => 1,
    1130599 => 1,
    1127283 => 1,
    1130544 => 1,
    1127374 => 1,
    936307 => 1,
    929693 => 1,
    784395 => 1,
    649547 => 1,
    649567 => 1,
    1190941 => 1,
    437243 => 1,
    929569 => 1,
    936353 => 1,
    1168473 => 1,
    1170354 => 1,
    1170083 => 1,
    649370 => 1,
    929645 => 1,
    351567 => 1,
    929534 => 1,
    936340 => 1,
    929690 => 1,
    929662 => 1,
    1263255 => 2,
    1263028 => 1,
    1263029 => 2,
    1263030 => 2,
    1263031 => 1,
    1263034 => 1,
    1263035 => 2,
    1263036 => 2,
    1263037 => 2,
    1263038 => 2,
    1263039 => 2,
    1263040 => 2,
    1263042 => 2,
    1263043 => 1,
    1263044 => 1,
    1263045 => 1,
    1263046 => 2,
    1263047 => 1,
    1263048 => 2,
    1263049 => 1,
    1263138 => 2,
    1263145 => 1,
    1263158 => 1,
    1263159 => 1,
    1263160 => 2,
    1263162 => 1,
    1263166 => 2,
    1263167 => 2,
    1263168 => 1,
    1263170 => 2,
    1263177 => 1,
    1263188 => 1,
    1263195 => 1,
    1263197 => 1,
    1263226 => 1,
    1263244 => 1,
    1263246 => 2,
    1263248 => 2,
    1260564 => 1,
    1260571 => 2,
    1260565 => 2,
    1260561 => 1,
    1260560 => 1,
    1260575 => 1,
    1260563 => 2,
    1260581 => 1,
    1260591 => 2,
    1260569 => 1,
    1260588 => 1,
    1260590 => 1,
    1260574 => 1,
    1260596 => 1,
    1260592 => 1,
    1260567 => 1,
    1260570 => 1,
    1260573 => 1,
    1260583 => 1,
    1260576 => 1,
    1260572 => 1,
    1260580 => 1,
    1260582 => 1,
    1260589 => 1,
    1260594 => 1,
    1260597 => 1,
    1260579 => 1,
    1260598 => 1,
    1260599 => 1,
    1260600 => 1,
    1260585 => 2,
    1260647 => 3,
    1260648 => 3,
    1261767 => 1,
    1261783 => 1,
    1261785 => 1,
    1261786 => 1,
    1262196 => 1,
    1262199 => 1,
    1262202 => 1,
    1262203 => 1,
    1262204 => 1,
    1262204 => 1,
    1262205 => 2,
    1262206 => 1,
    1262216 => 2,
    1262211 => 2,
    1262208 => 1,
    1262207 => 1,
    1262217 => 2,
    1262224 => 1,
    1262225 => 1,
    1262226 => 1,
    1262227 => 1,
    1262228 => 1,
    1262230 => 1,
    1262229 => 1,
    1262231 => 1,
    1262287 => 1,
    1262288 => 1,
    1260255 => 1,
    1260199 => 1,
    1260247 => 1,
    1260286 => 1,
    1260288 => 1,
    1260287 => 1,
    1260203 => 1,
    1260209 => 1,
    1260206 => 1,
    1260211 => 1,
    1260214 => 1,
    1260217 => 1,
    1260222 => 1,
    1260224 => 1,
    1260229 => 1,
    1260133 => 1,
    1260232 => 1,
    1260290 => 1,
    1260266 => 1,
    1260240 => 1,
    1260833 => 1,
    1260836 => 2,
    1260834 => 1,
    1260142 => 1,
    1260290 => 1,
    1260266 => 1,
    1260240 => 1,
    1260242 => 1,
    1260246 => 1,
    1260249 => 1,
    1260180 => 1,
    1260180 => 1,
    1260252 => 2,
    1260289 => 1,
    1260371 => 2,
    1260372 => 2,
    1260292 => 1,
    1260254 => 1,
    1260228 => 1,
    1260291 => 1,
    1260134 => 1,
    1260197 => 1,
    1260258 => 1,
    1260235 => 1,
    1260186 => 1,
    1260173 => 1,
    1260293 => 1,
    1260260 => 1,
    1260154 => 1,
    1260554 => 1,
    1260555 => 1,
    1260557 => 1,
    1260559 => 1,
    1260558 => 1,
    1260142 => 1,
    1259374 => 2,
    1259384 => 2,
    1259498 => 2,
    1259497 => 2,
    1259491 => 2,
    1259494 => 2,
    1259487 => 2,
    1259447 => 2,
    1259493 => 2,
    1259492 => 2,
    1259488 => 2,
    1259481 => 2,
    1259470 => 2,
    1259476 => 2,
    1259360 => 2,
    1259278 => 2,
    1259324 => 2,
    1259312 => 2,
    1259429 => 2,
    1259419 => 2,
    1259400 => 2,
    1259393 => 2,
    1259362 => 2,
    1259353 => 2,
    1259343 => 2,
    1259297 => 2,
    1259467 => 2,
    1259463 => 2,
    1259461 => 2,
    1259320 => 2,
    1259460 => 2,
    1259456 => 2,
    1259445 => 2,
    1259449 => 2,
    1259412 => 2,
    1259420 => 2,
    1259428 => 2,
    1259437 => 2,
    1259490 => 2,
    1259391 => 2,
    1259332 => 2,
    1259307 => 1,
    1259363 => 2,
    1259344 => 2,
    1259434 => 2,
    1259399 => 2,
    1259407 => 2,
    1259418 => 2,
    1259443 => 2,
    1259451 => 2,
    1259440 => 2,
    1259455 => 2,
    1259466 => 2,
    1259442 => 2,
    1259462 => 2,
    1259457 => 2,
    1259473 => 2,
    1259355 => 2,
    1259345 => 2,
    1259477 => 2,
    1259367 => 2,
    1259485 => 2,
    1259376 => 2,
    1259383 => 2,
    1259389 => 2,
    1259396 => 2,
    1259489 => 2,
    1259402 => 2,
    1259408 => 2,
    1259415 => 2,
    1259421 => 2,
    1259221 => 2,
    1259444 => 2,
    1259375 => 2,
    1259469 => 2,
    1259425 => 2,
    1260159 => 2,
    1260163 => 2,
    1260245 => 1,
    1260278 => 1,
    1260250 => 2,
    1260165 => 1,
    1260202 => 1,
    1260268 => 1,
    1260207 => 1,
    1260210 => 2,
    1260191 => 1,
    1260212 => 1,
    1260226 => 1,
    1260243 => 1,
    1260179 => 1,
    1260264 => 1,
    1260267 => 2,
    1260269 => 1,
    1260182 => 1,
    1260241 => 2,
    957090 => 1,
    387398 => 1,
    167997 => 1,
    319358 => 1,
    437221 => 1,
    454445 => 1,
    457471 => 1,
    457472 => 1,
    582803 => 1,
    652965 => 1,
    652985 => 1,
    652964 => 1,
    703152 => 1,
    862109 => 1,
    862112 => 1,
    862108 => 1,
    862110 => 1,
    862107 => 1,
    957088 => 1,
    957089 => 1,
    506463 => 1,
    506464 => 1,
    777489 => 1,
    1198957 => 1,
    1199213 => 1,
    1197822 => 1,
    872490 => 1,
    1076925 => 1,
    1131702 => 1,
    1181876 => 1,
    1181874 => 1,
    1191191 => 1,
    1191196 => 1,
    1191218 => 1,
    1191241 => 1,
    1191233 => 1,
    1066566 => 1,
    1066554 => 1,
    1066329 => 1,
    897815 => 2,
    1089946 => 1,
    1089951 => 1,
    1090023 => 1,
    1090025 => 1,
    1090027 => 1,
    1089892 => 1,
    1090037 => 1,
    1089954 => 1,
    1090026 => 1,
    1090030 => 1,
    1122307 => 1,
    1127600 => 1,
    1127606 => 1,
    1138577 => 1,
    1138855 => 1,
    1138863 => 1,
    1183786 => 1,
    1183758 => 1,
    1183773 => 1,
    1183777 => 1,
    1185083 => 1,
    1185089 => 1,
    1191626 => 1,
    1191628 => 1,
    1191629 => 1,
    1191656 => 1,
    1191639 => 1,
    1191643 => 1,
    1191641 => 1,
    1191645 => 1,
    655453 => 1,
    655601 => 1,
    655395 => 1,
    655313 => 1,
    635880 => 1,
    299423 => 1,
    362259 => 1,
    266672 => 1,
    266671 => 1,
    375857 => 1,
    362357 => 1,
    375759 => 1,
    375858 => 1,
    506348 => 1,
    506454 => 1,
    658292 => 1,
    658295 => 1,
    986177 => 1,
    1001004 => 1,
    1001005 => 1,
    1001007 => 1,
    1078399 => 1,
    1091813 => 1,
    1001013 => 1,
    1001481 => 1,
    1078405 => 1,
    1078346 => 1,
    1078325 => 1,
    1078379 => 1,
    1095173 => 1,
    1095435 => 1,
    1095854 => 1,
    1095854 => 1,
    1095874 => 1,
    1095882 => 1,
    1095881 => 1,
    1095888 => 1,
    1095889 => 1,
    1095883 => 1,
    1142754 => 1,
    1142758 => 1,
    1142757 => 1,
    1142765 => 1,
    1178141 => 1,
    1178142 => 1,
    1178140 => 1,
    1178143 => 1,
    1190593 => 1,
    1190601 => 1,
    1190606 => 1,
    1190608 => 1,
    1190614 => 1,
    1199223 => 1,
    1199224 => 1,
    1206299 => 1,
    1208094 => 1,
    1208102 => 1,
    1208095 => 1,
    1208098 => 1,
    1208099 => 1,
    1208107 => 1,
    1208108 => 1,
    1208103 => 1,
    1208109 => 1,
    1208104 => 1,
    1208105 => 1,
    1208112 => 1,
    1229896 => 1,
    1229900 => 1,
    1263846 => 1,
    1262545 => 1,
    1262546 => 1,
    1262547 => 1,
    1262548 => 1,
    1262549 => 1,
    1262550 => 1,
    1262551 => 1,
    1262552 => 1,
    1262553 => 1,
    1262554 => 1,
    1262555 => 1,
    1262556 => 1,
    1262557 => 1,
    1262558 => 1,
    1262559 => 1,
    1262560 => 1,
    1262561 => 1,
    1262562 => 1,
    1262563 => 1,
    1262564 => 1,
    1263627 => 1,
    1264118 => 1,
    1264064 => 1,
    1264036 => 1,
    1264111 => 1,
    1264121 => 1,
    1264138 => 1,
    1264133 => 1,
    1264051 => 1,
    1264059 => 1,
    1264116 => 1,
    1264072 => 1,
    1264147 => 1,
    1264158 => 1,
    1264037 => 1,
    1170329 => 2,
    1170418 => 2,
    1170350 => 2,
    1170415 => 2,
    1170551 => 2,
    1122319 => 2,
    1094752 => 2,
    1082508 => 2,
    1045238 => 2,
    1041256 => 2,
    955840 => 2,
    878638 => 2,
    878635 => 2,
    872772 => 2,
    872773 => 2,
    865292 => 2,
    861239 => 2,
    861241 => 2,
    832116 => 2,
    647779 => 2,
    647768 => 2,
    647781 => 2,
    647763 => 2,
    612739 => 2,
    583018 => 2,
    293933 => 2,
    1040629 => 2,
    1040627 => 2,
    1040613 => 2,
    677947 => 2,
    552623 => 2,
    492299 => 2,
    335135 => 2,
    330319 => 2,
    1266221 => 2,
    1266196 => 2,
    1266181 => 2,
    1266251 => 2,
    1266225 => 2,
    1266208 => 2,
    1266272 => 2,
    1217385 => 2,
    1190758 => 2,
    1190830 => 2,
    1190827 => 2,
    1190867 => 2,
    1190872 => 2,
    1190757 => 2,
    1190861 => 2,
    1190843 => 2,
    1190848 => 2,
    1190783 => 2,
    1190737 => 2,
    1190784 => 2,
    1190708 => 2,
    1180266 => 2,
    1181377 => 2,
    1180281 => 2,
    1180141 => 2,
    1180885 => 2,
    1181371 => 2,
    1180143 => 2,
    1181368 => 2,
    1180280 => 2,
    1181364 => 2,
    1181370 => 2,
    1180279 => 2,
    1180174 => 2,
    1181342 => 2,
    1180860 => 2,
    1181319 => 2,
    1181329 => 2,
    1180846 => 2,
    1180365 => 2,
    1181335 => 2,
    1181312 => 2,
    1180360 => 2,
    1181321 => 2,
    1181307 => 2,
    1180099 => 2,
    1180427 => 2,
    1181317 => 2,
    1180102 => 2,
    1180064 => 2,
    1181256 => 2,
    1180932 => 2,
    1180936 => 2,
    1180278 => 2,
    1180921 => 2,
    1180269 => 2,
    1180829 => 2,
    1170593 => 2,
    1170592 => 2,
    1170127 => 2,
    1170139 => 2,
    1170138 => 2,
    1170141 => 2,
    1170147 => 2,
    1170135 => 2,
    1170585 => 2,
    1170560 => 2,
    1170589 => 2,
    1169251 => 2,
    1122812 => 2,
    1108871 => 2,
    1093842 => 2,
    1093840 => 2,
    1093846 => 2,
    1082618 => 2,
    1082415 => 2,
    1082411 => 2,
    1082414 => 2,
    1082413 => 2,
    1082407 => 2,
    1082403 => 2,
    1072361 => 2,
    1072370 => 2,
    1069245 => 2,
    1051636 => 2,
    1045250 => 2,
    1045248 => 2,
    1041245 => 2,
    1041242 => 2,
    1041243 => 2,
    1041231 => 2,
    1003295 => 2,
    910183 => 2,
    438550 => 2,
    438549 => 2,
    1051628 => 2,
    1040641 => 2,
    1040619 => 2,
    1040632 => 2,
    1040615 => 2,
    1040612 => 2,
    1040621 => 2,
    1040604 => 2,
    1040600 => 2,
    910196 => 2,
    808142 => 2,
    807596 => 2,
    807564 => 2,
    775798 => 2,
    654571 => 2,
    492192 => 2,
    171498 => 2,
    1170341 => 2,
    1180883 => 2,
    1180114 => 2,
    1180893 => 2,
    1180809 => 2,
    1181247 => 2,
    1180728 => 2,
    1180270 => 2,
    1180155 => 2,
    1181276 => 2,
    1181305 => 2,
    1181310 => 2,
    1181340 => 2,
    1181318 => 2,
    1190690 => 2,
    1190703 => 2,
    1190709 => 2,
    1190707 => 2,
    1190720 => 2,
    1190761 => 2,
    1190760 => 2,
    1190726 => 2,
    1190773 => 2,
    1190852 => 2,
    1190791 => 2,
    1190842 => 2,
    1250090 => 2,
    1250003 => 2,
    1260218 => 2,
    1265908 => 2,
    1265916 => 2,
    1265909 => 2,
    1265910 => 2,
    1265914 => 2,
    1265911 => 2,
    1265912 => 2,
    1265913 => 2,
    1265915 => 2,
    1265917 => 2,
    1265918 => 2,
    1265919 => 2,
    1265921 => 2,
    1265930 => 2,
    1265931 => 2,
    1265935 => 2,
    1265936 => 2,
    1265933 => 2,
    1265934 => 2,
    1265937 => 2,
    1265938 => 2,
    1265939 => 2,
    1265940 => 2,
    1265945 => 2,
    1265946 => 2,
    401457 => 2,
    771146 => 2,
    784885 => 2,
    784887 => 2,
    980854 => 2,
    980855 => 2,
    1082136 => 2,
    1122314 => 2,
    1190845 => 2,
    1251546 => 2,
    1089860 => 2,
    680320 => 2,
    680319 => 2,
    680308 => 2,
    777167 => 2,
    777169 => 2,
    777170 => 2,
    777859 => 2,
    1066608 => 2,
    297484 => 2,
    301033 => 2,
    302751 => 2,
    325591 => 2,
    330416 => 2,
    330418 => 2,
    492160 => 2,
    492167 => 2,
    807573 => 2,
    807578 => 2,
    807586 => 2,
    178623 => 2,
    1070758 => 2,
    1089675 => 2,
    1093478 => 2,
    1093479 => 2,
    1093487 => 2,
    1093491 => 2,
    1093485 => 2,
    1093483 => 2,
    1108152 => 2,
    1118106 => 2,
    1122814 => 2,
    1217594 => 2,
    1217595 => 2,
    1217597 => 2,
    1217604 => 2,
    1253023 => 2,
];

// --- Subcategorie mapping ---
$productSubcategoryMap = [
    1138002 => 20,
    306246 => 2,
    441567 => 1,
    452825 => 20,
    1132319 => 22,
    1132054 => 8,
    531156 => 5,
    344493 => 1,
    1071278 => 2,
    721878 => 27,
    1132065 => 8,
    306387 => 2,
    137931 => 27,
    1178089 => 23,
    762393 => 2,
    491878 => 8,
    305825 => 7,
    1077010 => 7,
    490718 => 1,
    1225697 => 27,
    1137530 => 7,
    1217043 => 7,
    1061307 => 11,
    311992 => 11,
    438008 => 2,
    490702 => 1,
    1045386 => 2,
    1225978 => 2,
    314084 => 20,
    564026 => 7,
    897326 => 7,
    897297 => 8,
    897286 => 7,
    1076918 => 21,
    796505 => 7,
    491884 => 5,
    786802 => 7,
    453855 => 5,
    491885 => 7,
    1077058 => 7,
    1183836 => 20,
    442781 => 7,
    490722 => 13,
    1076968 => 7,
    1076902 => 7,
    1076897 => 7,
    1077050 => 7,
    308073 => 13,
    353977 => 1,
    496216 => 8,
    1137526 => 7,
    1180738 => 5,
    441806 => 21,
    308557 => 2,
    438607 => 2,
    440549 => 9,
    440599 => 9,
    433534 => 27,
    1131343 => 7,
    1087906 => 8,
    451262 => 7,
    379926 => 6,
    649520 => 1,
    451271 => 5,
    1071091 => 2,
    893982 => 1,
    929593 => 1,
    649556 => 1,
    649560 => 1,
    929563 => 1,
    499198 => 1,
    652417 => 1,
    652409 => 1,
    1127578 => 2,
    1071290 => 2,
    1071271 => 2,
    1184477 => 2,
    897877 => 2,
    495971 => 5,
    648546 => 5,
    1131341 => 20,
    311190 => 20,
    1183832 => 20,
    442804 => 20,
    442518 => 20,
    511934 => 20,
    492549 => 20,
    1132313 => 20,
    492531 => 20,
    601149 => 19,
    1183839 => 20,
    489237 => 20,
    386536 => 20,
    649482 => 6,
    1132315 => 19,
    650835 => 5,
    564210 => 19,
    1137519 => 5,
    1071519 => 13,
    1131346 => 23,
    1181277 => 15,
    498602 => 13,
    591155 => 13,
    490717 => 13,
    932337 => 13,
    319468 => 13,
    443839 => 15,
    788666 => 15,
    1076957 => 7,
    1076974 => 7,
    451211 => 21,
    1077049 => 7,
    306320 => 5,
    785250 => 1,
    785162 => 1,
    530765 => 1,
    1127359 => 13,
    441572 => 13,
    119453 => 27,
    933778 => 1,
    652520 => 13,
    307141 => 1,
    785209 => 1,
    934975 => 1,
    934987 => 13,
    457461 => 7,
    496217 => 21,
    319470 => 1,
    437172 => 13,
    322275 => 1,
    600716 => 1,
    680233 => 8,
    567639 => 7,
    1132795 => 2,
    1184469 => 2,
    490710 => 1,
    600719 => 1,
    1217600 => 7,
    1072290 => 7,
    1072326 => 7,
    1072289 => 2,
    437168 => 1,
    490716 => 1,
    1137536 => 7,
    44182 => 5,
    308125 => 8,
    1088539 => 8,
    653626 => 2,
    788429 => 2,
    307037 => 2,
    308556 => 2,
    441846 => 5,
    1088127 => 7,
    1093589 => 2,
    1088611 => 15,
    1132814 => 9,
    1073814 => 9,
    510322 => 9,
    1073786 => 9,
    831388 => 27,
    1077015 => 23,
    831416 => 27,
    776197 => 27,
    1240562 => 27,
    1175274 => 27,
    317057 => 27,
    1132298 => 21,
    1132312 => 21,
    1132079 => 7,
    438934 => 15,
    1217601 => 15,
    502301 => 21,
    897302 => 22,
    1129005 => 21,
    451267 => 7,
    1132051 => 7,
    1132898 => 21,
    1088559 => 21,
    1087908 => 7,
    1168340 => 5,
    1131349 => 5,
    1132807 => 7,
    1132089 => 7,
    531173 => 7,
    441820 => 21,
    786569 => 21,
    651306 => 21,
    786567 => 21,
    936328 => 8,
    569302 => 5,
    817055 => 1,
    352876 => 7,
    1087777 => 5,
    451747 => 5,
    600681 => 5,
    796503 => 5,
    796507 => 2,
    1089249 => 5,
    1130413 => 11,
    1087784 => 5,
    1087782 => 5,
    648959 => 5,
    452814 => 5,
    1061555 => 11,
    1061545 => 11,
    1061534 => 11,
    437993 => 2,
    443849 => 2,
    438950 => 2,
    1130590 => 1,
    441884 => 1,
    786818 => 2,
    786854 => 2,
    440299 => 2,
    936330 => 1,
    1130599 => 1,
    1127283 => 1,
    1130544 => 1,
    1127374 => 1,
    936307 => 1,
    929693 => 1,
    784395 => 1,
    649547 => 1,
    649567 => 1,
    1190941 => 1,
    437243 => 1,
    929569 => 1,
    936353 => 1,
    1168473 => 1,
    1170354 => 1,
    1170083 => 1,
    649370 => 1,
    929645 => 1,
    351567 => 1,
    929534 => 1,
    936340 => 1,
    929690 => 1,
    929662 => 1,
    1263255 => 25,
    1263028 => 11,
    1263029 => 25,
    1263030 => 25,
    1263031 => 11,
    1263034 => 11,
    1263035 => 25,
    1263036 => 25,
    1263037 => 25,
    1263038 => 25,
    1263039 => 25,
    1263040 => 25,
    1263042 => 25,
    1263043 => 11,
    1263044 => 11,
    1263045 => 11,
    1263046 => 25,
    1263047 => 11,
    1263048 => 25,
    1263049 => 11,
    1263138 => 25,
    1263145 => 11,
    1263158 => 11,
    1263159 => 11,
    1263160 => 25,
    1263162 => 11,
    1263166 => 25,
    1263167 => 25,
    1263168 => 11,
    1263170 => 25,
    1263177 => 5,
    1263188 => 11,
    1263195 => 2,
    1263197 => 11,
    1263226 => 11,
    1263244 => 11,
    1263246 => 25,
    1263248 => 25,
    1260564 => 5,
    1260571 => 20,
    1260565 => 15,
    1260561 => 2,
    1260560 => 10,
    1260575 => 5,
    1260563 => 19,
    1260581 => 5,
    1260591 => 19,
    1260569 => 5,
    1260588 => 5,
    1260590 => 5,
    1260574 => 5,
    1260596 => 5,
    1260592 => 5,
    1260567 => 5,
    1260570 => 5,
    1260573 => 5,
    1260583 => 5,
    1260576 => 5,
    1260572 => 5,
    1260580 => 5,
    1260582 => 5,
    1260589 => 5,
    1260594 => 5,
    1260597 => 5,
    1260579 => 5,
    1260598 => 5,
    1260599 => 5,
    1260600 => 5,
    1260585 => 14,
    1260647 => 33,
    1260648 => 33,
    1261767 => 11,
    1261783 => 11,
    1261785 => 2,
    1261786 => 2,
    1262196 => 11,
    1262199 => 11,
    1262202 => 11,
    1262203 => 11,
    1262204 => 11,
    1262204 => 11,
    1262205 => 25,
    1262206 => 11,
    1262216 => 25,
    1262211 => 25,
    1262208 => 11,
    1262207 => 11,
    1262217 => 25,
    1262224 => 11,
    1262225 => 11,
    1262226 => 11,
    1262227 => 11,
    1262228 => 11,
    1262230 => 11,
    1262229 => 11,
    1262231 => 11,
    1262287 => 11,
    1262288 => 11,
    1260255 => 1,
    1260199 => 1,
    1260247 => 1,
    1260286 => 1,
    1260288 => 1,
    1260287 => 1,
    1260203 => 1,
    1260209 => 1,
    1260206 => 1,
    1260211 => 1,
    1260214 => 1,
    1260217 => 1,
    1260222 => 1,
    1260224 => 1,
    1260229 => 1,
    1260133 => 1,
    1260232 => 1,
    1260290 => 1,
    1260266 => 1,
    1260240 => 1,
    1260833 => 12,
    1260836 => 26,
    1260834 => 12,
    1260142 => 1,
    1260290 => 1,
    1260266 => 1,
    1260240 => 1,
    1260242 => 1,
    1260246 => 1,
    1260249 => 1,
    1260180 => 1,
    1260180 => 1,
    1260252 => 13,
    1260289 => 1,
    1260371 => 26,
    1260372 => 26,
    1260292 => 1,
    1260254 => 1,
    1260228 => 1,
    1260291 => 1,
    1260134 => 1,
    1260197 => 1,
    1260258 => 1,
    1260235 => 1,
    1260186 => 1,
    1260173 => 1,
    1260293 => 1,
    1260260 => 1,
    1260154 => 11,
    1260554 => 10,
    1260555 => 10,
    1260557 => 10,
    1260559 => 10,
    1260558 => 10,
    1260142 => 1,
    1259374 => 25,
    1259384 => 25,
    1259498 => 25,
    1259497 => 25,
    1259491 => 25,
    1259494 => 25,
    1259487 => 25,
    1259447 => 25,
    1259493 => 25,
    1259492 => 25,
    1259488 => 25,
    1259481 => 25,
    1259470 => 25,
    1259476 => 25,
    1259360 => 25,
    1259278 => 25,
    1259324 => 25,
    1259312 => 25,
    1259429 => 25,
    1259419 => 25,
    1259400 => 25,
    1259393 => 25,
    1259362 => 25,
    1259353 => 25,
    1259343 => 25,
    1259297 => 25,
    1259467 => 25,
    1259463 => 25,
    1259461 => 25,
    1259320 => 25,
    1259460 => 25,
    1259456 => 25,
    1259445 => 25,
    1259449 => 25,
    1259412 => 25,
    1259420 => 25,
    1259428 => 25,
    1259437 => 25,
    1259490 => 25,
    1259391 => 25,
    1259332 => 25,
    1259307 => 11,
    1259363 => 25,
    1259344 => 25,
    1259434 => 25,
    1259399 => 25,
    1259407 => 25,
    1259418 => 25,
    1259443 => 25,
    1259451 => 25,
    1259440 => 25,
    1259455 => 25,
    1259466 => 25,
    1259442 => 25,
    1259462 => 25,
    1259457 => 25,
    1259473 => 25,
    1259355 => 25,
    1259345 => 25,
    1259477 => 25,
    1259367 => 25,
    1259485 => 25,
    1259376 => 25,
    1259383 => 25,
    1259389 => 25,
    1259396 => 25,
    1259489 => 25,
    1259402 => 25,
    1259408 => 25,
    1259415 => 25,
    1259421 => 25,
    1259221 => 25,
    1259444 => 25,
    1259375 => 25,
    1259469 => 25,
    1259425 => 25,
    1260159 => 25,
    1260163 => 25,
    1260245 => 11,
    1260278 => 11,
    1260250 => 25,
    1260165 => 11,
    1260202 => 11,
    1260268 => 11,
    1260207 => 11,
    1260210 => 25,
    1260191 => 11,
    1260212 => 1,
    1260226 => 1,
    1260243 => 1,
    1260179 => 1,
    1260264 => 1,
    1260267 => 13,
    1260269 => 1,
    1260182 => 1,
    1260241 => 13,
    957090 => 3,
    387398 => 3,
    167997 => 3,
    319358 => 3,
    437221 => 3,
    454445 => 3,
    457471 => 3,
    457472 => 3,
    582803 => 3,
    652965 => 3,
    652985 => 3,
    652964 => 3,
    703152 => 3,
    862109 => 3,
    862112 => 3,
    862108 => 3,
    862110 => 3,
    862107 => 3,
    957088 => 3,
    957089 => 3,
    506463 => 4,
    506464 => 4,
    777489 => 4,
    1198957 => 4,
    1199213 => 4,
    1197822 => 4,
    872490 => 8,
    1076925 => 8,
    1131702 => 8,
    1181876 => 8,
    1181874 => 8,
    1191191 => 8,
    1191196 => 8,
    1191218 => 8,
    1191241 => 8,
    1191233 => 8,
    1066566 => 8,
    1066554 => 8,
    1066329 => 8,
    897815 => 22,
    1089946 => 9,
    1089951 => 9,
    1090023 => 9,
    1090025 => 9,
    1090027 => 9,
    1089892 => 9,
    1090037 => 9,
    1089954 => 9,
    1090026 => 9,
    1090030 => 9,
    1122307 => 9,
    1127600 => 9,
    1127606 => 9,
    1138577 => 9,
    1138855 => 9,
    1138863 => 9,
    1183786 => 9,
    1183758 => 9,
    1183773 => 9,
    1183777 => 9,
    1185083 => 9,
    1185089 => 9,
    1191626 => 9,
    1191628 => 9,
    1191629 => 9,
    1191656 => 9,
    1191639 => 9,
    1191643 => 9,
    1191641 => 9,
    1191645 => 9,
    655453 => 10,
    655601 => 10,
    655395 => 10,
    655313 => 10,
    635880 => 10,
    299423 => 10,
    362259 => 10,
    266672 => 10,
    266671 => 10,
    375857 => 10,
    362357 => 10,
    375759 => 10,
    375858 => 10,
    506348 => 10,
    506454 => 10,
    658292 => 10,
    658295 => 10,
    986177 => 10,
    1001004 => 10,
    1001005 => 10,
    1001007 => 10,
    1078399 => 10,
    1091813 => 10,
    1001013 => 10,
    1001481 => 10,
    1078405 => 10,
    1078346 => 10,
    1078325 => 10,
    1078379 => 10,
    1095173 => 10,
    1095435 => 10,
    1095854 => 10,
    1095874 => 10,
    1095882 => 10,
    1095881 => 10,
    1095888 => 10,
    1095889 => 10,
    1095883 => 10,
    1142754 => 10,
    1142758 => 10,
    1142757 => 10,
    1142765 => 10,
    1178141 => 10,
    1178142 => 10,
    1178140 => 10,
    1178143 => 10,
    1190593 => 10,
    1190601 => 10,
    1190606 => 10,
    1190608 => 10,
    1190614 => 10,
    1199223 => 10,
    1199224 => 10,
    1206299 => 10,
    1208094 => 10,
    1208102 => 10,
    1208095 => 10,
    1208098 => 10,
    1208099 => 10,
    1208107 => 10,
    1208108 => 10,
    1208103 => 10,
    1208109 => 10,
    1208104 => 10,
    1208105 => 10,
    1208112 => 10,
    1229896 => 10,
    1229900 => 10,
    1263846 => 10,
    1262545 => 12,
    1262546 => 12,
    1262547 => 12,
    1262548 => 12,
    1262549 => 12,
    1262550 => 12,
    1262551 => 12,
    1262552 => 12,
    1262553 => 12,
    1262554 => 12,
    1262555 => 12,
    1262556 => 12,
    1262557 => 12,
    1262558 => 12,
    1262559 => 12,
    1262560 => 12,
    1262561 => 12,
    1262562 => 12,
    1262563 => 12,
    1262564 => 12,
    1263627 => 12,
    1264118 => 12,
    1264064 => 12,
    1264036 => 12,
    1264111 => 12,
    1264121 => 12,
    1264138 => 12,
    1264133 => 12,
    1264051 => 12,
    1264059 => 12,
    1264116 => 12,
    1264072 => 12,
    1264147 => 12,
    1264158 => 12,
    1264037 => 12,
    1170329 => 13,
    1170418 => 13,
    1170350 => 13,
    1170415 => 13,
    1170551 => 13,
    1122319 => 13,
    1094752 => 13,
    1082508 => 13,
    1045238 => 13,
    1041256 => 13,
    955840 => 13,
    878638 => 13,
    878635 => 13,
    872772 => 13,
    872773 => 13,
    865292 => 13,
    861239 => 13,
    861241 => 13,
    832116 => 13,
    647779 => 13,
    647768 => 13,
    647781 => 13,
    647763 => 13,
    612739 => 13,
    583018 => 13,
    293933 => 13,
    1040629 => 13,
    1040627 => 13,
    1040613 => 13,
    677947 => 13,
    552623 => 13,
    492299 => 13,
    335135 => 13,
    330319 => 13,
    1266221 => 13,
    1266196 => 13,
    1266181 => 13,
    1266251 => 13,
    1266225 => 13,
    1266208 => 13,
    1266272 => 13,
    1217385 => 13,
    1190758 => 13,
    1190830 => 13,
    1190827 => 13,
    1190867 => 13,
    1190872 => 13,
    1190757 => 13,
    1190861 => 13,
    1190843 => 13,
    1190848 => 13,
    1190783 => 13,
    1190737 => 13,
    1190784 => 13,
    1190708 => 13,
    1180266 => 13,
    1181377 => 13,
    1180281 => 13,
    1180141 => 13,
    1180885 => 13,
    1181371 => 13,
    1180143 => 13,
    1181368 => 13,
    1180280 => 13,
    1181364 => 13,
    1181370 => 13,
    1180279 => 13,
    1180174 => 13,
    1181342 => 13,
    1180860 => 13,
    1181319 => 13,
    1181329 => 13,
    1180846 => 13,
    1180365 => 13,
    1181335 => 13,
    1181312 => 13,
    1180360 => 13,
    1181321 => 13,
    1181307 => 13,
    1180099 => 13,
    1180427 => 13,
    1181317 => 13,
    1180102 => 13,
    1180064 => 13,
    1181256 => 13,
    1180932 => 13,
    1180936 => 13,
    1180278 => 13,
    1180921 => 13,
    1180269 => 13,
    1180829 => 13,
    1170593 => 13,
    1170592 => 13,
    1170127 => 13,
    1170139 => 13,
    1170138 => 13,
    1170141 => 13,
    1170147 => 13,
    1170135 => 13,
    1170585 => 13,
    1170560 => 13,
    1170589 => 13,
    1169251 => 13,
    1122812 => 13,
    1108871 => 13,
    1093842 => 13,
    1093840 => 13,
    1093846 => 13,
    1082618 => 13,
    1082415 => 13,
    1082411 => 13,
    1082414 => 13,
    1082413 => 13,
    1082407 => 13,
    1082403 => 13,
    1072361 => 13,
    1072370 => 13,
    1069245 => 13,
    1051636 => 13,
    1045250 => 13,
    1045248 => 13,
    1041245 => 13,
    1041242 => 13,
    1041243 => 13,
    1041231 => 13,
    1003295 => 13,
    910183 => 13,
    438550 => 13,
    438549 => 13,
    1051628 => 13,
    1040641 => 13,
    1040619 => 13,
    1040632 => 13,
    1040615 => 13,
    1040612 => 13,
    1040621 => 13,
    1040604 => 13,
    1040600 => 13,
    910196 => 13,
    808142 => 13,
    807596 => 13,
    807564 => 13,
    775798 => 13,
    654571 => 13,
    492192 => 13,
    171498 => 13,
    1170341 => 13,
    1180883 => 13,
    1180114 => 13,
    1180893 => 13,
    1180809 => 13,
    1181247 => 13,
    1180728 => 13,
    1180270 => 13,
    1180155 => 13,
    1181276 => 13,
    1181305 => 13,
    1181310 => 13,
    1181340 => 13,
    1181318 => 13,
    1190690 => 13,
    1190703 => 13,
    1190709 => 13,
    1190707 => 13,
    1190720 => 13,
    1190761 => 13,
    1190760 => 13,
    1190726 => 13,
    1190773 => 13,
    1190852 => 13,
    1190791 => 13,
    1190842 => 13,
    1250090 => 13,
    1250003 => 13,
    1260218 => 13,
    1265908 => 13,
    1265916 => 13,
    1265909 => 13,
    1265910 => 13,
    1265914 => 13,
    1265911 => 13,
    1265912 => 13,
    1265913 => 13,
    1265915 => 13,
    1265917 => 13,
    1265918 => 13,
    1265919 => 13,
    1265921 => 13,
    1265930 => 13,
    1265931 => 13,
    1265935 => 13,
    1265936 => 13,
    1265933 => 13,
    1265934 => 13,
    1265937 => 13,
    1265938 => 13,
    1265939 => 13,
    1265940 => 13,
    1265945 => 13,
    1265946 => 13,
    401457 => 15,
    771146 => 15,
    784885 => 15,
    784887 => 15,
    980854 => 15,
    980855 => 15,
    1082136 => 15,
    1122314 => 15,
    1190845 => 15,
    1251546 => 15,
    1089860 => 16,
    680320 => 16,
    680319 => 16,
    680308 => 16,
    777167 => 17,
    777169 => 17,
    777170 => 17,
    777859 => 17,
    1066608 => 17,
    297484 => 16,
    301033 => 16,
    302751 => 16,
    325591 => 16,
    330416 => 16,
    330418 => 16,
    492160 => 16,
    492167 => 16,
    807573 => 16,
    807578 => 16,
    807586 => 16,
    178623 => 16,
    1070758 => 16,
    1089675 => 16,
    1093478 => 16,
    1093479 => 16,
    1093487 => 16,
    1093491 => 16,
    1093485 => 16,
    1093483 => 16,
    1108152 => 16,
    1118106 => 16,
    1122814 => 16,
    1217594 => 16,
    1217595 => 16,
    1217597 => 16,
    1217604 => 16,
    1253023 => 18,
];

echo "=== DEBUG MODE ACTIEF ===\n\n";

// ---------------------------------------------------------
// 0) STOCK FILTER (ACTIEF)
// ---------------------------------------------------------
echo "=== START STOCK FILTER ===\n\n";

$filteredProducts = [];
$processedProducts = [];

foreach ($selectedProducts as $productId) {
    echo "ðŸŸ¦ Controleer product $productId...\n";

    // --- 12u import guard ---
    $stmtCheck = $conn->prepare("
        SELECT last_import_run
        FROM products
        WHERE id = ?
        LIMIT 1
    ");
    $stmtCheck->bind_param("i", $productId);
    $stmtCheck->execute();
    $resCheck = $stmtCheck->get_result();
    $rowCheck = $resCheck->fetch_assoc();
    $stmtCheck->close();

    if ($rowCheck) {
        $lastRun = $rowCheck['last_import_run'];

        if ($lastRun !== null && strtotime($lastRun) > strtotime('-12 hours')) {
            echo "â­ Product $productId minder dan 12u geleden geÃ¯mporteerd â†’ behouden\n\n";
            $processedProducts[] = $productId; // ðŸ‘ˆ essentieel
            continue;
        }
    }

    // Product ophalen
    try {
        $response = $api->getProduct($productId);
    } catch (Exception $e) {
        echo "â›” getProduct() timeout â†’ product overslaan\n\n";
        logMessage("â›” getProduct timeout voor product $productId â†’ overslaan");
        sleep(5);
        continue;
    }
    $prod = json_decode($response['response'], true);
    if (isset($prod[0])) $prod = $prod[0];

    if (empty($prod['sku'])) {
        echo "â›” Geen SKU â†’ overslaan\n\n";
        sleep(5);
        continue;
    }

    $sku = $prod['sku'];
    echo "âž¡ SKU gevonden: $sku\n";

    // Stockcheck op parent product
    try {
        $stockResp = $api->getStockByProduct((int)$productId);
    } catch (Exception $e) {
        echo "â›” getStockByProduct() timeout â†’ product overslaan\n\n";
        logMessage("â›” Stock timeout voor product $productId â†’ overslaan");
        sleep(5);
        continue;
    }
    $stockJson = json_decode($stockResp['response'], true);
    $available = 0;
    if (!empty($stockJson['stocks']) && is_array($stockJson['stocks'])) {
        foreach ($stockJson['stocks'] as $stockEntry) {
            if (!empty($stockEntry['quantity']) && $stockEntry['quantity'] > $available) {
                $available = (int)$stockEntry['quantity'];
            }
        }
    }

    if ($available <= 0) {
        echo "â›” Product niet op voorraad â†’ overslaan\n\n";
        sleep(5);
        continue;
    }

    echo "âœ” Product op voorraad ($available units) â†’ toevoegen\n\n";

    $filteredProducts[] = $productId;
    sleep(5);
}

if (empty($filteredProducts)) die("â›” Geen producten beschikbaar in stock\n");

$selectedProducts = $filteredProducts;
echo "\n=== GEFILTERDE PRODUCTEN (STOCK OK) ===\n";
print_r($selectedProducts);
echo "\n\n";

// ------------------- IMPORT LOOP MET VARIANTS & STOCKCHECK -------------------
$languageMap = ['nl'=>'be-nl','fr'=>'be-fr','en'=>'be-en','de'=>'be-de'];

// EÃ©nmalig taxonomies ophalen
$taxonomiesRespRaw = $api->getTaxonomies();
$firstLevelRespRaw = $api->getTaxonomiesFirstLevel();

$taxonomiesResp = json_decode($taxonomiesRespRaw['response'] ?? '', true) ?: [];
$firstLevelResp = json_decode($firstLevelRespRaw['response'] ?? '', true) ?: [];
$firstLevelIds  = array_column($firstLevelResp, 'id');

foreach ($selectedProducts as $productId) {
    echo "\n==============================\n";
    echo "ðŸ“Œ PRODUCT $productId START\n";
    echo "==============================\n\n";

    try {
        try {
            $response = $api->getProduct($productId);
        } catch (Exception $e) {
            echo "â›” getProduct timeout â†’ product $productId overslaan\n";
            logMessage("â›” getProduct timeout bij product $productId â†’ overslaan");
            sleep(5);
            continue;
        }
        $prod = json_decode($response['response'], true);
        if (isset($prod[0])) $prod = $prod[0];
        if (empty($prod['id']) || empty($prod['sku'])) {
            sleep(5);
            continue;
        }

        // Product info NL
        try {
            $infoResponse = $api->getProductInformationBySku($prod['sku'], 'nl');
        } catch (Exception $e) {
            echo "â›” ProductInformation timeout â†’ product $productId overslaan\n";
            logMessage("â›” ProductInfo timeout voor $productId â†’ overslaan");
            sleep(5);
            continue;
        }
        $details = json_decode($infoResponse['response'], true);
        if (!empty($details[0])) $details = $details[0];

        if (empty($details['id']) || empty($details['sku'])) {
            echo "â›” Geen details beschikbaar, overslaan\n";
            sleep(5);
            continue;
        }

        // Description & specifications
        $rawDescription = $details['description'] ?? '';
        preg_match_all('/<li[^>]*>(.*?)<\/li>/is', $rawDescription, $matches);
        $specifications = implode(';', array_map(fn($v) => trim(strip_tags($v)), $matches[1] ?? []));
        $descriptionClean = trim(strip_tags(preg_replace('/<ul.*?<\/ul>/is','',$rawDescription)));

        // ----------------- Variants ophalen -----------------
        // 1) Product info
        sleep(5);
        $productResp = $api->getProduct($productId);
        $productInfo = json_decode($productResp['response'] ?? '', true);
        if (!$productInfo || !is_array($productInfo)) {
            echo "â›” Kan product info niet ophalen\n";
            sleep(5);
            continue;
        }
        if (isset($productInfo[0])) $productInfo = $productInfo[0];

        // 2) Taxonomy van product
        $productTaxonomyId = $productInfo['taxonomy'] ?? $productInfo['category'] ?? null;
        if (!$productTaxonomyId) {
            logMessage("â›” Geen taxonomy gevonden voor product $productId\n");
            sleep(5);
            continue;
        }

        // 3) Zoek parent taxonomy
        $parentTaxonomy = $productTaxonomyId;
        $maxLoops = 20; $i=0;
        while (!in_array($parentTaxonomy, $firstLevelIds, true) && $i<$maxLoops) {
            $found = false;
            foreach ($taxonomiesResp as $t) {
                if (($t['id'] ?? null) === $parentTaxonomy) {
                    $parentTaxonomy = $t['parentTaxonomy'] ?? $t['id'];
                    $found = true;
                    break;
                }
            }
            if (!$found) break;
            $i++;
        }

        // DEBUG
        echo "âœ… Parent taxonomy gevonden: $parentTaxonomy\n";

        // 4) Variations ophalen
        $variationsRespRaw = $api->getProductsVariations($parentTaxonomy);
        $variationsResp = json_decode($variationsRespRaw['response'] ?? '', true) ?: [];
        echo "Variations count: " . count($variationsResp) . "\n";

        // 5) Variation â†’ attribute IDs
        $varAttrRespRaw = $api->getVariationsAttributes($parentTaxonomy);
        $varAttr = json_decode($varAttrRespRaw['response'] ?? '', true) ?: [];

        $varAttrMap = [];
        foreach ($varAttr as $va) {
            $id = $va['id'] ?? null;
            if ($id) $varAttrMap[$id] = $va['attributes'] ?? [];
        }

        // 6) Attributes ophalen
        $attrRespRaw = $api->getAttributes('en', $parentTaxonomy);
        $attrList = json_decode($attrRespRaw['response'] ?? '', true) ?: [];

        $attrMap = [];
        foreach ($attrList as $a) {
            if (($a['attributeGroup'] ?? null) == 162) {
                $attrMap[$a['id']] = $a['name'] ?? 'Unknown';
            }
        }

        // 7) Variants â†’ sizes
        $variants = [];
        foreach ($variationsResp as $v) {
            $varId = $v['id'] ?? null;
            $sku = $v['sku'] ?? null;
            $vProductId = $v['product'] ?? null; // alleen van dit product
            if (!$varId || !$sku || $vProductId != $productId) continue;

            $itemId = $v['id'] ?? null;

            // 1) Stock ophalen per variant
            $variantStock = 0;

            if ($itemId) {
                try {
                    $stockResp = $api->getProductVariationStock($itemId);
                    $stockJson = json_decode($stockResp['response'], true);

                    if (!empty($stockJson[0]['stocks']) && is_array($stockJson[0]['stocks'])) {
                        foreach ($stockJson[0]['stocks'] as $entry) {
                            $qty = (int)($entry['quantity'] ?? 0);
                            if ($qty > $variantStock) {
                                $variantStock = $qty;
                            }
                        }
                    }
                } catch (Exception $e) {
                    echo "â›” Variant stock timeout voor itemId $itemId â†’ variant overslaan\n";
                    sleep(5);
                    continue;
                }
            }

            // 2) Variant NIET toevoegen als stock == 0
            if ($variantStock <= 0) {
                echo "â›” Variant $sku (itemId $itemId) niet op voorraad â†’ overslaan\n";
                sleep(5);
                continue;
            }

            echo "âœ” Variant $sku (itemId $itemId) heeft stock ($variantStock)\n";

            // 3) Variant registreren
            $variants[$sku] = [];
            $attributes = $varAttrMap[$varId] ?? [];
            foreach ($attributes as $a) {
                $attrId = $a['id'] ?? null;
                if ($attrId && isset($attrMap[$attrId])) {
                    $variants[$sku][] = $attrMap[$attrId];
                }
            }
            sleep(5);
        }

        // --- 7b) Check of alle varianten zonder stock zitten
        if (!empty($variationsResp) && empty($variants)) {
            // Varianten bestaan, maar geen enkele heeft stock
            $active = 0;
            echo "âš  Product $productId heeft varianten maar GEEN stock â†’ active=0\n";
        } else {
            // Geen varianten, of minstens 1 variant met stock
            $active = 1;
        }

        // --- 7c) Maak Ã©Ã©n string van alle attributen ---
        $allAttributes = [];
        foreach ($variants as $attrArray) {
            foreach ($attrArray as $a) {
                $allAttributes[] = $a;
            }
        }

        // Uniek maken
        $allAttributes = array_unique($allAttributes);

        // 1ï¸âƒ£ Definieer bekende standaardmaten
        $sizeOrder = ['XXS','XS','S','M','L','XL','XXL','XXXL'];

        // 2ï¸âƒ£ Categoriseer sizes
        $standard = [];
        $numeric  = [];
        $age      = [];
        $other    = [];

        foreach ($allAttributes as $s) {
            $trim = trim($s);
            if (in_array($trim, $sizeOrder)) {
                $standard[] = $trim;
            } elseif (preg_match('/^\d+$/', $trim)) {
                $numeric[] = (int)$trim; // nummers opslaan als int voor sortering
            } elseif (preg_match('/^(\d+)-(\d+)\s*years$/i', $trim, $matches)) {
                $age[] = $trim; // hou string, sorteren later
            } else {
                $other[] = $trim;
            }
        }

        // 3ï¸âƒ£ Sorteer elke categorie
        // Standaard: volgorde van sizeOrder
        usort($standard, function($a,$b) use ($sizeOrder){ 
            return array_search($a,$sizeOrder) - array_search($b,$sizeOrder);
        });

        // Numeriek: laag naar hoog
        sort($numeric, SORT_NUMERIC);

        // Leeftijd: laagste leeftijd eerst
        usort($age, function($a,$b){
            preg_match('/^(\d+)-(\d+)/', $a, $mA);
            preg_match('/^(\d+)-(\d+)/', $b, $mB);
            return (int)$mA[1] - (int)$mB[1];
        });

        // Other: alfabetisch
        sort($other, SORT_STRING);

        // 4ï¸âƒ£ Alles achter elkaar zetten
        $numeric = array_map('strval', $numeric); // ints terug naar strings
        $finalSizes = array_merge($age, $standard, $numeric, $other);
        $resultSizes = implode(';', $finalSizes);
        var_dump($resultSizes);
        if (empty($resultSizes)) {
            $resultSizes = null;
        }
        $maat = $resultSizes;

        // ----------------- Images -----------------
        $image=''; $localImageDir=__DIR__.'/products';
        if(!file_exists($localImageDir)) mkdir($localImageDir,0777,true);
        if(!empty($prod['images']['images']) && is_array($prod['images']['images'])){
            $imagesArr = $prod['images']['images'];
            usort($imagesArr, fn($a,$b)=>(!empty($b['isCover'])?1:0)<=>(!empty($a['isCover'])?1:0));
            $imagePaths=[]; $counter=1;
            foreach($imagesArr as $img){
                if(empty($img['url'])) {
                    sleep(5);
                    continue;
                }
                $urlPath=parse_url($img['url'],PHP_URL_PATH);
                $ext=pathinfo($urlPath,PATHINFO_EXTENSION)?:'jpg';
                $localFile="{$productId}_{$counter}.".$ext;
                $localPath=$localImageDir.'/'.$localFile;
                $content=@file_get_contents($img['url']);
                if($content!==false){file_put_contents($localPath,$content); $imagePaths[]='products/'.$localFile;$counter++;}
            }
            $image=implode(';',$imagePaths);
        }

        // ----------------- Price -----------------
        $price = prijsMetAfronding($details['wholesalePrice'] ?? $prod['wholesalePrice'] ?? 0);

        // ----------------- Data voor DB -----------------
        $dataForDb = [
            'id'=>$productId,
            'category_id'=>$productCategoryMap[$productId]??1,
            'subcategory_id'=>$productSubcategoryMap[$productId]??null,
            'name'=>$details['name']??$prod['name']??'',
            'description'=>$descriptionClean,
            'specifications'=>$specifications,
            'maat'=>$maat,
            'price'=>$price,
            'image'=>$image,
            'active'=>$active
        ];

        // ----------------- Insert/Update DB -----------------
        $stmt=$conn->prepare("
            INSERT INTO products (id,category_id,subcategory_id,name,description,specifications,maat,price,image,created_at,active)
            VALUES (?,?,?,?,?,?,?,?,?,NOW(),?)
            ON DUPLICATE KEY UPDATE
                category_id=VALUES(category_id),
                subcategory_id=VALUES(subcategory_id),
                name=VALUES(name),
                description=VALUES(description),
                specifications=VALUES(specifications),
                maat=NULLIF(VALUES(maat), ''),
                price=VALUES(price),
                image=VALUES(image),
                active=VALUES(active)
        ");
        $stmt->bind_param(
            "iiissssdsi",
            $dataForDb['id'],
            $dataForDb['category_id'],
            $dataForDb['subcategory_id'],
            $dataForDb['name'],
            $dataForDb['description'],
            $dataForDb['specifications'],
            $dataForDb['maat'],
            $dataForDb['price'],
            $dataForDb['image'],
            $dataForDb['active']
        );
        $stmt->execute();

        // ----------------- Vertalingen -----------------
        foreach($languageMap as $bbLang=>$dbLang){
            sleep(5);
            $infoResponseLang = $api->getProductInformationBySku($prod['sku'],$bbLang);
            $detailsLang = json_decode($infoResponseLang['response'],true);
            if(!empty($detailsLang[0])) $detailsLang=$detailsLang[0];
            if(empty($detailsLang['sku'])) {
                sleep(5);
                continue;
            }
            $rawDescriptionLang = $detailsLang['description']??'';
            preg_match_all('/<li[^>]*>(.*?)<\/li>/is', $rawDescriptionLang, $matchesLang);
            $specificationsLang = implode(';', array_map(fn($v) => trim(strip_tags($v)), $matchesLang[1] ?? []));
            $descriptionCleanLang = trim(strip_tags(preg_replace('/<ul.*?<\/ul>/is','',$rawDescriptionLang)));
            $nameLang=$detailsLang['name']??'';
            $stmtTrans=$conn->prepare("
                INSERT INTO product_translations (product_id,lang,name,description,specifications,maat,created_at)
                VALUES (?,?,?,?,?,?,NOW())
                ON DUPLICATE KEY UPDATE
                    name=VALUES(name),
                    description=VALUES(description),
                    specifications=VALUES(specifications),
                    maat=VALUES(maat),
                    updated_at=NOW()
            ");
            $maatLang = $dataForDb['maat'];
            $stmtTrans->bind_param("isssss", $productId, $dbLang, $nameLang, $descriptionCleanLang, $specificationsLang, $maatLang);
            $stmtTrans->execute();
            echo "âœ” Vertaling ($dbLang) opgeslagen!\n";
            logMessage("âœ” Vertaling $dbLang voor product $productId succesvol geÃ¯mporteerd");
        }

        echo "âœ” Product opgeslagen in database!\n";
        logMessage("âœ” Product $productId succesvol geÃ¯mporteerd");

        $stmtUpdateRun = $conn->prepare("
            UPDATE products
            SET last_import_run = NOW()
            WHERE id = ?
        ");
        $stmtUpdateRun->bind_param("i", $productId);
        $processedProducts[] = $productId;
        $stmtUpdateRun->execute();
        $stmtUpdateRun->close();

    } catch(Exception $e){
        echo "â›” Fout bij product $productId: ".$e->getMessage()."\n";
        logMessage("â›” Fout bij product $productId: ".$e->getMessage());
    }

    unset($variationsResp, $varAttr, $varAttrMap, $attrList, $attrMap, $variants, $allAttributes);
    gc_collect_cycles();

    sleep(5);
}

// ----------------------------------------
// 3) Niet-verwerkte producten deactiveren
// ----------------------------------------
if (!empty($processedProducts)) {

    $placeholders = implode(',', array_fill(0, count($processedProducts), '?'));
    $types = str_repeat('i', count($processedProducts));

    $stmtInactive = $conn->prepare("
        UPDATE products
        SET active = 0
        WHERE id NOT IN ($placeholders)
    ");

    $stmtInactive->bind_param($types, ...$processedProducts);
    $stmtInactive->execute();
    $stmtInactive->close();

    echo "âœ” Alle niet-verwerkte producten gedeactiveerd (active=0)\n";
    logMessage("âœ” Niet-verwerkte producten gedeactiveerd");
}

echo "\n=== IMPORT VOLTOOID ===\n";
?>